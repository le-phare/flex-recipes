{
    "manifests": {
        "faros-ng/deploy-pack": {
            "manifest": {
                "copy-from-recipe": {
                    "ansible/": "ansible/"
                },
                "post-install-output": [
                    "<bg=blue;fg=white>                          </>",
                    "<bg=blue;fg=white> Deployment configuration </>",
                    "<bg=blue;fg=white>                          </>",
                    "",
                    "  * Modify project variables in ansible/project.yml </>",
                    "",
                    "  * Configure each environment ansible/<env>/app/vars </>"
                ]
            },
            "files": {
                "ansible/database.yml": {
                    "contents": [
                        "---",
                        "- name: Sync local database with remote",
                        "  hosts: app",
                        "  roles:",
                        "    - db-pull",
                        "  vars:",
                        "    db_pull_local_backup_path: ../var/database/",
                        "    db_pull_remote_backup_path: \"{{ ansistrano_deploy_to }}/db_dump\"",
                        "    db_pull_remote_database_host: localhost",
                        "    db_pull_remote_database_port: 5432",
                        "    db_pull_remote_database_password: \"{{ vault_database_password }}\"",
                        ""
                    ],
                    "executable": false
                },
                "ansible/deploy.yml": {
                    "contents": [
                        "---",
                        "- name: Deploy app",
                        "  hosts: app",
                        "  roles:",
                        "      - lephare.ansible-deploy",
                        "  vars_files:",
                        "      - project.yml",
                        "  vars:",
                        "      ansible_ssh_common_args: \" -o ForwardAgent=yes\"",
                        "      ansistrano_shared_files:",
                        "          - .env.local",
                        "      ansistrano_shared_paths:",
                        "          - var/log",
                        "          - var/exchange",
                        "          - public/build",
                        "      lephare_sentry_notify: true",
                        "      lephare_sentry_token: <sentry api token>",
                        "      lephare_assets_build_path: \"../public/build/\"",
                        "      lephare_assets_web_path: \"build/\"",
                        "      lephare_assets_publish: false",
                        "      lephare_document_root_path: \"{{ ansistrano_release_path.stdout }}/public\"",
                        "      lephare_composer_options: \"--no-dev --optimize-autoloader --apcu-autoloader --no-interaction\"",
                        "      lephare_crontab_path: \"{{ ansistrano_release_path.stdout }}/.crontab\"",
                        "      lephare_crontab_install: true",
                        "      lephare_install_adminer: true",
                        "      lephare_http_basic_password: <admin_password>",
                        "  tasks:",
                        "      - name: Check directory",
                        "        delegate_to: localhost",
                        "        stat:",
                        "            path: ../public/build/",
                        "        register: build_dir",
                        "",
                        "      - name: Upload assets",
                        "        when: build_dir.stat.exists and build_dir.stat.isdir",
                        "        synchronize:",
                        "            src: ../public/build/",
                        "            dest: \"{{ ansistrano_deploy_to }}/shared/public/\"",
                        "            recursive: yes",
                        "            delete: yes",
                        ""
                    ],
                    "executable": false
                },
                "ansible/preprod/group_vars/app/vars": {
                    "contents": [
                        "# deploy variables",
                        "ansible_user: <remote_ssh_user>",
                        "ansistrano_deploy_to: <remote_deploy_dir>",
                        "application_environment: preprod",
                        "lephare_default_git_branch: develop",
                        "lephare_http_basic_secure: true",
                        "lephare_prevent_robots_indexation: true",
                        "",
                        "# db-pull variables",
                        "db_pull_remote_database_name: <remote_database_name>",
                        "db_pull_remote_database_user: <remote_database_user>",
                        "",
                        ""
                    ],
                    "executable": false
                },
                "ansible/preprod/group_vars/app/vault": {
                    "contents": [
                        "vault_database_password: <remote_database_password>"
                    ],
                    "executable": false
                },
                "ansible/preprod/hosts": {
                    "contents": [
                        "[app]",
                        "<preprod_domain>"
                    ],
                    "executable": false
                },
                "ansible/production/group_vars/app/vars": {
                    "contents": [
                        "# deploy variables",
                        "ansible_user: <remote_ssh_user>",
                        "ansistrano_deploy_to: <remote_deploy_dir>",
                        "lephare_default_git_branch: master",
                        "application_environment: production",
                        "",
                        "# db-pull variables",
                        "db_pull_remote_database_name: <remote_database_name>",
                        "db_pull_remote_database_user: <remote_database_user>",
                        ""
                    ],
                    "executable": false
                },
                "ansible/production/group_vars/app/vault": {
                    "contents": [
                        "vault_database_password: <remote_database_password>"
                    ],
                    "executable": false
                },
                "ansible/production/hosts": {
                    "contents": [
                        "[app]",
                        "<production_domain>",
                        ""
                    ],
                    "executable": false
                },
                "ansible/project.yml": {
                    "contents": [
                        "ansistrano_git_repo: <git_repository>",
                        "lephare_sentry_project: <sentry_project>",
                        "lephare_http_basic_user: <admin_user>",
                        "",
                        "db_pull_local_database_host: <local_database_host>",
                        "db_pull_local_database_name: <local_database_name>",
                        "db_pull_local_database_user: <local_database_user>",
                        "db_pull_local_database_password: <local_database_password>",
                        ""
                    ],
                    "executable": false
                }
            },
            "ref": "07bc10ab5f1f77d8a1595111b3f3e7ce9058cea4"
        }
    }
}
